<?xml version="1.0"?>
<openerp>
    <data>        
    <!--mrp.production.material-->
    <record model="ir.ui.view" id="view_mrp_production_material_tree">
        <field name="name">Production material</field>
        <field name="model">mrp.production.material</field>
        <field name="arch" type="xml">
            <tree string="Material for production">
               <field name='product_id'/>
               <!--<field name='mrp_production_id'/>-->
               <field name='workcenter_production_id'/>
               <!--<field name='accounting_qty'/>-->
               <field name='quantity' sum="total"/>
               <field name='uom_id'/>
           </tree>
        </field>
    </record>    
    <record model="ir.ui.view" id="view_mrp_production_material_form">
        <field name="name">Production material</field>
        <field name="model">mrp.production.material</field>
        <field name="arch" type="xml">
            <form string="Material for production" version="7.0">
               <sheet>
                   <group colspan="4" col="4">
                       <field name='product_id' readonly="True" />
                       <!--<field name='mrp_production_id'/>-->
                       <field name='workcenter_production_id' readonly="True"/>
                       <!--<field name='accounting_qty'/>-->
                       <field name='quantity' readonly="True"/>
                       <field name='uom_id'/>
                   </group>    
               </sheet>    
           </form>
        </field>
    </record>    
    <record model="ir.ui.view" id="view_mrp_production_material_search">
        <field name="name">Production material</field>
        <field name="model">mrp.production.material</field>
        <field name="arch" type="xml">
            <search string="Material for production">
                <field name="product_id" string="Product" filter_domain="[('product_id','=',self)]"/>
                <field name="workcenter_production_id" string="Workcenter" filter_domain="[('workcenter_id','=',self)]"/> 
                <group expand="1" string="Group By...">
                    <filter name="group_workcenter" string="Lavoration" icon="terp-partner" context="{'group_by':'workcenter_production_id'}"/>
                    <filter name="group_product" string="Product" icon="terp-accessories-archiver" context="{'group_by':'product_id'}"/>
                </group>                    
           </search>
        </field>
    </record>    
    <record model="ir.actions.act_window" id="action_mrp_production_material">
        <field name="name">Lavoration unload</field>
        <field name="res_model">mrp.production.material</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_mrp_production_material_tree"/>
        <field name="context">{}</field>
        <field name="domain">[('mrp_production_id','=',False)]</field>
    </record>

    <!--mrp.workcenter.history-->
    <record model="ir.ui.view" id="view_mrp_workcenter_history_tree_view">
        <field name="name">Workcenter lavoration history</field>
        <field name="model">mrp.workcenter.history</field>
        <field name="arch" type="xml">
            <tree string="Lavoration history">
               <field name= 'date'/>
               <field name= 'product_id'/>
               <field name= 'workcenter_id'/>
               <field name= 'single_cycle_duration' widget="float_time"/>
               <field name= 'single_cycle_qty'/>
               <field name= 'parameter_hammer'/>
               <field name= 'parameter_grid'/>
               <field name= 'parameter_speed'/>
               <field name= 'parameter_temperature' />
               <field name= 'parameter_time_misc'  widget="float_time"/>
           </tree>
        </field>
    </record>    
    <record model="ir.ui.view" id="view_mrp_workcenter_history_form_view">
        <field name="name">Workcenter lavoration history</field>
        <field name="model">mrp.workcenter.history</field>
        <field name="arch" type="xml">
            <form string="Lavoration history" version="7.0">
               <sheet>
                   <group colspan="4" col="4">
                       <field name='date'/>
                       <newline/>
                       <field name='product_id'/>
                       <field name='workcenter_id'/>
                       <field name='single_cycle_duration' widget="float_time"/>
                       <field name='single_cycle_qty'/>
                       
                       <separator string="Line-Product parameters:" colspan="4" />
                       <field name= 'parameter_hammer'/>
                       <field name= 'parameter_grid'/>
                       <field name= 'parameter_speed'/>
                       <field name= 'parameter_temperature'/>
                       <field name= 'parameter_time_misc'  widget="float_time"/>
                       
                       <separator string="Parameter note:" colspan="4"/>
                       <field name= 'parameter_note' nolabel="1" colspan="4"/>
                   </group>    
               </sheet>    
           </form>
        </field>
    </record>    
    <record model="ir.ui.view" id="view_mrp_workcenter_history_search_view">
        <field name="name">Search workcenter history</field>
        <field name="model">mrp.workcenter.history</field>
        <field name="arch" type="xml">
            <search string="Workcenter history">
                    <field name="product_id" string="Product" filter_domain="[('product_id','=',self)]"/>
                    <field name="workcenter_id" string="Workcenter" filter_domain="[('workcenter_id','=',self)]"/> 

                    <group expand="1" string="Group By...">
                        <filter name="group_workcenter" string="Workcenter" icon="terp-partner" context="{'group_by':'workcenter_id'}"/>
                        <filter name="group_product" string="Product" icon="terp-accessories-archiver" context="{'group_by':'product_id'}"/>
                    </group>                    
            </search>
        </field>
    </record>    
    <record model="ir.actions.act_window" id="action_view_mrp_workcenter_history_form">
        <field name="name">Workcenter history</field>
        <field name="res_model">mrp.workcenter.history</field>        
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_mrp_workcenter_history_search_view"/>
    </record>
    <menuitem name="Workcenter history" parent="mrp.menu_view_resource_search_mrp" id="menu_mrp_workcenter_history" action="action_view_mrp_workcenter_history_form" sequence="10" />
    
    <!--mrp.workcenter--> 
    <record model="ir.ui.view" id="view_mrp_workcenter_tree_view">
        <field name="name">Workcenter history tree</field>
        <field name="model">mrp.workcenter</field>
        <field name="inherit_id" ref="mrp.mrp_workcenter_tree_view" />
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="cost_product_id" />
                <field name="parent_workcenter_id" />
            </field>
        </field>
    </record>    
    <record model="ir.ui.view" id="view_mrp_workcenter_form_view">
        <field name="name">Workcenter history</field>
        <field name="model">mrp.workcenter</field>
        <field name="inherit_id" ref="mrp.mrp_workcenter_view" />
        <field name="arch" type="xml">
            <xpath expr="/form/notebook/page[@string='General Information']" position="attributes">
               <attribute name="invisible">1</attribute>
            </xpath>

            <field name="active" position="after">
                <field name="cost_product_id" groups="production_line.group_production_admin" />
                <field name="hour_daily_work" />       
                <field name="parent_workcenter_id" groups="production_line.group_production_admin" />         
            </field>

            <xpath expr="/form/notebook/page[@string='General Information']" position="before">
               <page string="History" attrs="{'invisible':[('parent_workcenter_id','!=',False)]}" groups="production_line.group_production_admin">
                   <field name="history_lavoration_ids" context="{'default_workcenter_id':active_id}">
                      <tree string="Product parameters:"><!-- editable="bottom"-->
                           <field name='date' />
                           <field name='product_id' />
                           <field name='single_cycle_duration' widget="float_time"/>
                           <field name='single_cycle_qty'/>
                           <field name='parameter_hammer'/>
                           <field name='parameter_grid'/>
                           <field name='parameter_speed'/>
                           <field name='parameter_temperature'/>
                           <field name='parameter_time_misc'  widget="float_time"/>                           
                      </tree>                      
                   </field>
               </page>
            </xpath>            
        </field>
    </record>    
    <record model="ir.ui.view" id="view_mrp_workcenter_form_establishment_view">
        <field name="name">Workcenter establishment</field>
        <field name="model">mrp.workcenter</field>
        <field name="inherit_id" ref="production_line.view_mrp_workcenter_form_view" />
        <field name="groups_id" eval="[(6, 0, [ref('production_line.group_production_production')])]" />
        <field name="arch" type="xml">
            <field name="hour_daily_work" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
        </field>
    </record>        
    
    <!--sale.order-->
    <record model="ir.ui.view" id="view_sale_order_form_extra_fields">
        <field name="name">Order deadline</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form" />
        <field name="arch" type="xml">
            <xpath expr="/form/header" position="attributes">
               <attribute name="attrs">{'invisible':[('accounting_order','=',True)]}</attribute>
            </xpath>

            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree/field[@name='price_subtotal']" position="after">
               <field name="accounting_state" />
            </xpath>

            <xpath expr="/form/sheet/notebook/page/field[@name='order_line']/tree" position="attributes">
               <attribute name="colors">red:accounting_state=='deleted'</attribute>
            </xpath>
            
            <field name="date_order" position="after">
                <group name="delivery" attrs="{'invisible':[('accounting_order','=',False)]}" colspan="4" col="2">
                   <field name="date_deadline" />
                   <!--<field name="date_previous_deadline" attrs="{'invisible':[('accounting_state','not in',('modify',))]}"/>-->
                   <field name="date_delivery" attrs="{'required':[('accounting_state','=','planned')]}"/>
                   <button colspan="2" name="confirm_delivery" type="object" string="Confirm delivery" attrs="{'invisible':[('accounting_state','in',('planned','deleted','close',))]}"/>
                </group>       
                <field name="accounting_state" readonly="1" attrs="{'invisible':[('accounting_order','=',False)]}"/>
                <field name="accounting_order" invisible="1" />
            </field>            
        </field>
    </record>    
    <record model="ir.ui.view" id="view_sale_order_tree_extra_fields">
        <field name="name">Order accounting</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_quotation_tree" />
        <field name="arch" type="xml">
            <xpath expr="/tree" position="attributes">
                <attribute name="colors">grey:state=='cancel';blue:state in ('waiting_date','manual');red:state in ('invoice_except','shipping_except');grey:accounting_order</attribute>
            </xpath>
            <field name="state" position="before">
                <field name="accounting_order" />
                <field name="accounting_state" />
            </field>            
        </field>
    </record>        
    
    <record model="ir.ui.view" id="view_sale_order_line_tree_state">
        <field name="name">State</field>
        <field name="model">sale.order.line</field>
        <field name="inherit_id" ref="sale.view_order_line_tree" />
        <field name="arch" type="xml">
            <field name="state" position="after">
                <field name="accounting_state" />
            </field>            
        </field>
    </record>   

    <!--sale.order.line--> <!--TODO sembra non funzionare -->
    <record model="ir.ui.view" id="view_order_form_production_details">
        <field name="name">Lavoration default</field>
        <field name="model">sale.order.line</field>
        <field name="inherit_id" ref="sale.view_order_line_tree" />
        <field name="arch" type="xml">
            <field name="name" position="after">
                <field name="mrp_production_id" />
            </field>            
        </field>
    </record>    

    <record model="ir.ui.view" id="view_mrp_production_workcenter_graph_hour">
        <field name="name">Workcenter graph</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <graph string="Workcenter load" type="bar">
                <field name="workcenter_id"/>
                <field name="hour" operator="+" />
                <!--<field name="product_qty" operator="+" />-->
            </graph>
        </field>
    </record>

    <record model="ir.ui.view" id="mrp_production_workcenter_line_search_view">
        <field name="name">Lavoration default</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="inherit_id" ref="mrp_operations.view_mrp_production_workcenter_form_view_filter" />
        <field name="arch" type="xml">
            <field name="state" position="after">
                <field name="product"/>
                <field name="name" string="Lavoration number"/>                
                <field name="accounting_sl_code" string="SL"/>
                
                <filter icon="terp-go-home" name="only_imported" string="With SL" domain="[('accounting_sl_code','!=',False)]" groups="production_line.group_production_admin"/>
                <newline/>

                <filter icon="terp-go-home" name="MRP_more_yesterday" string="Passed lavorations" 
                    domain="[('real_date_planned','&gt;=',(context_today()-relativedelta(days=4)).strftime('%%Y-%%m-%%d 00:00:00')),('real_date_planned','&lt;=',context_today().strftime('%%Y-%%m-%%d 23:59:59')),]" context="{'group_by':'workcenter_id'}" />
                <filter icon="terp-go-home" name="MRP_today-1" string="Yestarday lavorations" 
                    domain="[('state','not in',('done','cancel')),('real_date_planned','&gt;=',(context_today()-relativedelta(days=1)).strftime('%%Y-%%m-%%d 00:00:00')),('real_date_planned','&lt;=',(context_today()-relativedelta(days=1)).strftime('%%Y-%%m-%%d 23:59:59')),]" context="{'group_by':'workcenter_id'}" />
                <filter icon="terp-go-home" name="MRP_today" string="Today lavorations" 
                    domain="[('state','not in',('done','cancel')),('real_date_planned','&gt;=',time.strftime('%%Y-%%m-%%d 00:00:00')),('real_date_planned','&lt;=',time.strftime('%%Y-%%m-%%d 23:59:59'))]" context="{'group_by':'workcenter_id'}"/>
                <filter icon="terp-go-home" name="MRP_today+1" string="Tomorrow lavorations" 
                    domain="[('state','not in',('done','cancel')),('real_date_planned','&gt;=',(context_today()+relativedelta(days=1)).strftime('%%Y-%%m-%%d 00:00:00')),('real_date_planned','&lt;=',(context_today()+relativedelta(days=1)).strftime('%%Y-%%m-%%d 23:59:59')),]" context="{'group_by':'workcenter_id'}" />
                <filter icon="terp-go-home" name="MRP_more_tomorrow" string="Future lavorations" 
                    domain="[('real_date_planned','&gt;=',(context_today()+relativedelta(days=1)).strftime('%%Y-%%m-%%d 00:00:00')),('real_date_planned','&lt;=',(context_today()+relativedelta(days=4)).strftime('%%Y-%%m-%%d 23:59:59')),]" context="{'group_by':'workcenter_id'}" />
                
                <newline/>
                <filter icon="terp-go-home" name="only_open" string="Only open" domain="[('state','not in',('done','cancel'))]" />
                <filter icon="terp-go-home" name="to_close_and_unload" string="To close (confirm unload)" domain="[('load_confirmed','=',True),('state','=','startworking')]" />

                <newline/>
                <field name="real_date_planned" string="From date" filter_domain="[('real_date_planned','&gt;=',self)]"/>
                <field name="real_date_planned" string="To date" filter_domain="[('real_date_planned','&lt;=',self)]"/>            
            </field>     
        </field>
    </record> 

    <record model="ir.ui.view" id="mrp_production_workcenter_line_calendar_planner_view">
        <field name="name">Lavoration default</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="arch" type="xml">
            <calendar color="workcenter_id" date_start="real_date_planned" date_delay="hour" string="Lavorazioni" mode="week">
	            <field name="product" />
	            <field name="product_qty" />
	            <field name="uom" />
	            <field name="production_id" />
            </calendar>
        </field>
    </record>    

   <!--Short view for establishment team-->
    <record model="ir.ui.view" id="view_product_product_establishment_lite">
        <field name="name">Product extablishment</field>
        <field name="model">product.product</field>
        <field name="priority" eval="40" />
        <field name="arch" type="xml">
             <form string="Prodotto" version="7.0">
	            <sheet>
            		<field name="image_medium" widget="image" class="oe_avatar oe_left" readonly="1"/>
		            <div class="oe_title">
			            <div class="oe_edit_only">
				            <label for="name" string="Nome prodotto"/>
			            </div>
			            <h1>
				            <field name="name"  readonly="1"/>
			            </h1>
			            <!--<label for="categ_id" class="oe_edit_only"/>
			            <h2>
				            <field name="categ_id" readonly="1" />
			            </h2>-->
			            <div name="options">
				            <field name="adr" readonly="1"/>
				            <label for="adr"/>
				            <field name="sale_ok" readonly="1"/>
				            <label for="sale_ok"/>
				            <field name="purchase_ok" readonly="1"/>
				            <label for="purchase_ok" />
			            </div>
            		</div>
            		<group colspan="4" col="4">
				        <field name="default_code" readonly="1"/>
				        <field name="statistic_category" readonly="1"/>
         				<field name="ean13" readonly="1"/>
				        <field name="active" readonly="1" />
				        <field name="description_sale" readonly="1" colspan="4"/>
				    </group>     
            	</sheet>
             </form>           
         </field>
    </record>   

    <record model="ir.ui.view" id="default_mrp_production_workcenter_line_view">
        <field name="name">Lavoration default</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="inherit_id" ref="mrp_operations.mrp_production_workcenter_form_view_inherit" />
        <field name="arch" type="xml">
            <!--Not readonly time:-->
            <field name="date_start" position="attributes">
                <attribute name="readonly">0</attribute>
            </field>
            <field name="date_start" position="after">
                <button name="date_start_now" string="Start now" type="object" attrs="{'invisible':['|',('state','in',('draft')),('date_finished','!=',False)]}" groups="production_line.group_production_admin"/>
                <newline />
            </field>
            <field name="date_finished" position="attributes">
                <attribute name="readonly"></attribute>
            </field>
            <field name="date_finished" position="after">
                <button name="date_stop_now" string="Stop now" type="object" attrs="{'invisible':[('state','in',('draft'))]}" groups="production_line.group_production_admin"/>
                <newline />
            </field>

            <!--Hide header (and sometimes replace)-->
            <xpath expr="/form/sheet/notebook/page/group/group[@string='Actual Production Date']" position="attributes">
                <attribute name="groups">production_line.group_production_admin</attribute>                
            </xpath>
            
            <field name="date_planned" position="before">
                <field name="real_date_planned" />
                <field name="real_date_planned_end" readonly="1" groups="production_line.group_production_admin" />
            </field>
            <field name="date_planned" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="date_planned_end" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>            
            <button name="button_done" position="attributes">
                <attribute name="invisible">1</attribute>
            </button>
            <button name="button_done" position="after">
                <button name="%(action_confirm_mrp_production_wizard_form)d" string="Completata" states="startworking" type="action" class="oe_highlight" context="{'default_state':'material'}" />
                <button name="%(action_confirm_mrp_production_wizard_form)d" string="Carichi" states="done" type="action" class="oe_highlight" context="{'default_state':'product'}"/>
            </button>    
            <field name="sequence" position="attributes">
                 <attribute name="invisible">1</attribute>
            </field>
            <field name="workcenter_id" position="attributes">
                <attribute name="on_change">onchange_workcenter_load_cycle(product,workcenter_id,real_date_planned,cycle)</attribute>
            </field>
            <field name="qty" position="attributes">
                <attribute name="string">Production total q.</attribute>
            </field>
            <!--<field name="hour" position="attributes">
                <attribute name="on_change">onchange_cycle_values(cycle,single_cycle_duration,single_cycle_qty,real_date_planned,hour,product_qty,'hour')</attribute>
            </field>-->
            <field name="cycle" position="attributes">
                <attribute name="on_change">onchange_cycle_values(cycle,single_cycle_duration,single_cycle_qty,real_date_planned,hour,product_qty)</attribute>
            </field>
            <field name="cycle" position="after"> 
                <field name="single_cycle_duration" widget="float_time" on_change="onchange_cycle_values(cycle,single_cycle_duration,single_cycle_qty,real_date_planned,hour,product_qty)" />
                <field name="single_cycle_qty" on_change="onchange_cycle_values(cycle,single_cycle_duration,single_cycle_qty,real_date_planned,hour,product_qty)" />
            </field>
            <field name="hour" position="after">
                <field name="force_cycle_default" groups="production_line.group_production_admin"/>
                <button name="%(action_split_mrp_production_wizard_form)d" string="Split lavoration" type="action" attrs="{'invisible':[('state','in',('done','cancel'))]}" groups="production_line.group_production_admin"/>
            </field>
            <field name="qty" position="after">
                <field name="product_qty" groups="production_line.group_production_admin" /><!--on_change="onchange_cycle_values(cycle,single_cycle_duration,single_cycle_qty,real_date_planned,hour,product_qty,'quantity')"/>-->
                <field name="real_product_qty" sum="total" states="startworking,done" groups="production_line.group_production_admin" />
            </field>
            <xpath expr="/form/sheet/notebook" position="inside">
                <page string="Material"> 
			        <group string="Used material (for all loads)" colspan="4" col="4">				              
                        <button type="object" colspan="2" name="load_materials_from_bom" string="Reload element from BOM" class="oe_highlight" attrs="{'invisible':[('unload_confirmed','=',True)]}"/> 
                        <button type="object" colspan="2" name="load_materials_from_production" string="Reload from Production" class="oe_highlight" attrs="{'invisible':[('unload_confirmed','=',True)]}"/>

                        <field name="unload_confirmed" string="Material sync in accounting" attrs="{'invisible':[('state','!=','startworking')]}"/>
                        <field name="accounting_sl_code" readonly="1" attrs="{'invisible':[('unload_confirmed','=',False)]}"/>
                        <newline/>
                        <field name="material_from_production" invisible="1" />
				        <field name="bom_material_ids" nolabel="1" colspan="4"  attrs="{'readonly':[('unload_confirmed','=',True)]}">
				            <tree string="Material BOM list" editable="bottom">
                                <field name="product_id" />
                                <field name="uom_id" readonly="1" />
                                <field name="quantity" sum="total"/>
                                <field name="accounting_qty" readonly="1"/>                                
                            </tree>                                
				        </field>
				        <group colspan="2" col="2">
    				        <separator string="Lavoration note:" colspan="2" />
    				        <field name="lavoration_note" colspan="2" nolabel="1" />
				        </group>
				        <group colspan="2" col="2">
				            <separator string="Anomalies:" colspan="2" />
    				        <field name="anomalie_note" colspan="2" nolabel="1" />
				        </group>
				    </group>                
                </page>
                <page string="Load">
			        <group string="List of partial load">				              			            
                        <group colspan="4" col="4">
				            <field name="load_ids" nolabel="1" colspan="4" context="{'embedded':True, }" />
				        </group>    
				    </group>                  
				 </page>
            </xpath>
        </field>
    </record>  

    <!--Establishment locked elements:-->
    <record model="ir.ui.view" id="default_mrp_production_workcenter_line_establishment_view">
        <field name="name">Lavoration default establishment</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="inherit_id" ref="mrp_operations.mrp_production_workcenter_form_view_inherit" />
        <field name="groups_id" eval="[(6, 0, [ref('production_line.group_production_production')])]" />
        <field name="arch" type="xml">
            <xpath expr="/form" position="attributes">
                <attribute name="create">0</attribute>
                <attribute name="delete">0</attribute>
            </xpath>
            <!--<field name="workcenter_id" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>-->
            <field name="name" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="production_id" position="attributes">
                <attribute name="groups">production_line.group_production_admin</attribute>
            </field>            
            <field name="production_state" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>            
            <field name="hour" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <xpath expr="/form/div[@class='oe_chatter']" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
        </field>
    </record>
    <record model="ir.ui.view" id="default_mrp_production_workcenter_line_establishment_bis_view">
        <field name="name">Lavoration default establishment bis</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="inherit_id" ref="production_line.default_mrp_production_workcenter_line_view" /><!--This module view-->
        <field name="groups_id" eval="[(6, 0, [ref('production_line.group_production_production')])]" />
        <field name="arch" type="xml">
            <!--<field name="cycle" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="single_cycle_duration" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>
            <field name="single_cycle_qty" position="attributes">
                <attribute name="readonly">1</attribute>
            </field>-->                
            <field name="product" position="attributes">
                <attribute name="context">{'form_view_ref':'production_line.view_product_product_establishment_lite'}</attribute>
            </field>
            <xpath expr="//page[@string='Material']/group/field/tree/field[@name='product_id']" position="attributes">
                <attribute name="context">{'form_view_ref':'production_line.view_product_product_establishment_lite'}</attribute>
            </xpath>            
        </field>
   </record>
        
    <!--mrp.production.workcenter.load-->    
    <record model="ir.ui.view" id="default_mrp_production_workcenter_load_search_view">
        <field name="name">Lavoration load</field>
        <field name="model">mrp.production.workcenter.load</field>
        <field name="arch" type="xml">
           <search string="Load list">
                <field name="line_id" string="Lavoration"/>
                <field name="recycle_product_id" />                
                <field name="package_id" />
                <field name="accounting_cl_code" />
                <field name="product_code" />
                <field name="workcenter_line_id" />
	            <field name="product_id" />
                
                <!--<field name="wrong" />
                <field name="recycle" />
                <field name="partial" />-->
                <filter icon="terp-go-home" name="cl_check" string="Production check" domain="[('accounting_cl_code','!=',False)]"  context="{'group_by':('date','product_id','production_id')}"/>
                <newline/>                
                <filter icon="terp-go-home" name="cl" string="CL sync" domain="[('accounting_cl_code','!=',False)]" />

                <filter icon="terp-go-home" name="wrong" string="Wrong" domain="[('wrong','=',True)]" />
                <filter icon="terp-go-home" name="recycle" string="Recycle" domain="[('recycle','=',True)]" />
                <newline/>
                <filter icon="terp-go-home" name="partial" string="Partial load" domain="[('partial','=',True)]" />
                <filter icon="terp-go-home" name="last" string="Last load" domain="[('partial','=',False)]" />
                <!--<field name="workcenter_production_id" string="Workcenter" filter_domain="[('workcenter_id','=',self)]"/>
                <filter icon="terp-go-home" name="only_open" string="Only open" domain="[('state','not in',('done','cancel'))]" />-->
                <group expand="1" string="Group By...">
                    <filter name="group_workcenter" string="Lavoration" icon="terp-partner" context="{'group_by':'line_id'}"/>
                    <filter name="group_product" string="Product" icon="terp-accessories-archiver" context="{'group_by':'product_id'}"/>
                    <filter name="group_production" string="Production" icon="terp-accessories-archiver" context="{'group_by':'production_id'}"/>
                    <filter name="group_line" string="Line" icon="terp-accessories-archiver" context="{'group_by':'workcenter_line_id'}"/>
                    <filter name="group_date" string="Date" icon="terp-accessories-archiver" context="{'group_by':'date'}"/>
                    <filter name="group_package" string="Package" icon="terp-accessories-archiver" context="{'group_by':'package_id'}"/>
                    <filter name="group_recycle_product" string="Recycle product" icon="terp-accessories-archiver" context="{'group_by':'recycle_product_id'}"/>
                </group>                    
           </search>                                
        </field>
    </record>    
    <record model="ir.ui.view" id="default_mrp_production_workcenter_load_tree_view">
        <field name="name">Lavoration load tree</field>
        <field name="model">mrp.production.workcenter.load</field>
        <field name="arch" type="xml">
           <tree string="Load list" colors="red:package_id and not ul_qty;brown:wrong;orange:recycle==True" create="0">
                <field name="accounting_cl_code" />
                <field name="sequence" />
                <field name="date" />
                <field name="line_id" invisible="context.get('embedded',False)"/>
                <field name="user_id" invisible="1"/>
                <field name="product_qty" sum="total" />
                <field name="wrong" />
                <field name="recycle" />
                <field name="recycle_product_id" />                
                <field name="partial" />
                <field name="package_id" />
                <field name="ul_qty" />
                <field name="pallet_qty" string="Pallets"/>
           </tree>                                
        </field>
    </record>
    <record model="ir.ui.view" id="default_mrp_production_workcenter_load_tree_readonly_view">
        <field name="name">Lavoration load tree</field>
        <field name="model">mrp.production.workcenter.load</field>
        <field name="priority" eval="50" />
        <field name="arch" type="xml">
           <tree string="Load list" colors="red:package_id and not ul_qty;brown:wrong;orange:recycle==True" editable="bottom" create="0" delete="0">
                <field name="accounting_cl_code" readonly="1" string="CL"/>
                <field name="sequence" readonly="1" />
                <field name="date" readonly="1" />
                <field name="production_id" readonly="1"/>
                <field name="line_id" readonly="1"/>
                <field name="workcenter_line_id" readonly="1"/>
                <field name="user_id" invisible="1"/>
	            <field name="product_id" readonly="1" />
                <field name="product_code" readonly="1" />
                <field name="product_qty" sum="total"  readonly="1"/>
                <field name="wrong" readonly="1"/>
                <field name="recycle" readonly="1"/>
                <field name="recycle_product_id"  readonly="1"/>                
                <field name="partial" readonly="1"/>
                <field name="package_id" readonly="1"/>
                <field name="ul_qty" readonly="1"/>
                <field name="pallet_qty" string="Pallets" readonly="1"/>
           </tree>                                
        </field>
    </record>
    <record model="ir.ui.view" id="default_mrp_production_workcenter_load_form_view">
        <field name="name">Lavoration load tree</field>
        <field name="model">mrp.production.workcenter.load</field>
        <field name="arch" type="xml">
            <form string="Load list" version="7.0">
                <sheet>
                    <group colspan="4" col="4">
                        <separator string="Load info:" colspan="4" />
                        <field name="sequence" readonly="1" />
                        <field name="accounting_cl_code" readonly="1" />

                        <field name="date" />
                        <field name="user_id" />

                        <field name="accounting_cost" readonly="1" />
                        <field name="accounting_cost_confirmed" readonly="1" />

                        <field name="product_code" />                                    
                        <field name="product_qty" sum="total" />

                        <separator string="Packaging and palleting:" colspan="4"/>
                        <field name="package_id" />
                        <field name="ul_qty" />

                        <field name="pallet_product_id" />
                        <field name="pallet_qty" />
                        
                        <separator string="Error lavoration:" colspan="4"/>
                        <field name="recycle" />
                        <field name="recycle_product_id" />                

                        <field name="wrong" />
                        <field name="partial" />

                        <group colspan="4" col="4" string="Wrong production comment:" attrs="{'invisible':[('wrong','=',False)]}">
                            <field name="wrong_comment" colspan="4" nolabel="1"/>
                        </group>
                    </group>
                 </sheet>   
            </form>                                
        </field>
    </record>
    
    <record model="ir.actions.act_window" id="action_mrp_production_workcenter_load">
        <field name="name">Production load</field>
        <field name="res_model">mrp.production.workcenter.load</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="default_mrp_production_workcenter_load_tree_readonly_view"/>
        <field name="context">{}</field>
        <field name="domain">[]</field>
    </record>
    
    <record model="ir.ui.view" id="default_mrp_production_workcenter_line_tree_view">
        <field name="name">Lavoration default</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="inherit_id" ref="mrp_operations.mrp_production_workcenter_tree_view_inherit" />
        <field name="arch" type="xml">
            <field name="date_planned" position="before">
                <field name="real_date_planned" />
            </field>
            <field name="date_planned" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>

            <!-- Change tree line colors-->
            <xpath expr="/tree" position="attributes">
            colors="blue:state == 'startworking';geen:state == 'done';grey:state == 'draft';red:(state in ('pause','cancel'))">
                <attribute name="colors">green:state == 'done';grey:state == 'cancel';blue:state in ('startworking',);orange:state in ('draft') and real_date_planned&gt;=current_date;red:real_date_planned&lt;current_date and state in ('draft', 'confirmed', 'ready')</attribute>
            </xpath>
            
            <!--Hide header -->
            <field name="qty" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <field name="qty" position="after">
                <field name="product_qty" />
                <field name="real_product_qty" sum="total" />
                <field name="accounting_sl_code" string="SL"/>
                <field name="load_confirmed" invisible="1" />
                <!--<field name="lavoration_number" />  -->              
            </field>
        </field>
    </record>    
    <record model="ir.ui.view" id="default_mrp_production_workcenter_line_establishment_tree_view">
        <field name="name">Lavoration default establishment</field>
        <field name="model">mrp.production.workcenter.line</field>
        <field name="groups_id" eval="[(6, 0, [ref('production_line.group_production_production')])]" />
        <field name="inherit_id" ref="mrp_operations.mrp_production_workcenter_tree_view_inherit" />
        <field name="arch" type="xml">
            <xpath expr="/tree" position="attributes">
                <attribute name="create">0</attribute>
                <attribute name="delete">0</attribute>
            </xpath>
        </field>    
    </record>
     
    <!--mrp.production-->
    <record model="ir.ui.view" id="default_mrp_production_tree_view">
        <field name="name">Production list default</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_tree_view" />
        <field name="arch" type="xml">
            <!--Tree colors -->
            <xpath expr="/tree" position="attributes">
                <attribute name="colors">colors="blue:accounting_state in ('draft',);green:accounting_state in ('production',);red:accounting_state in ('cancel',);black:accounting_state in ('close',);</attribute>
            </xpath>
            
            <field name="product_qty" position="after">
                <field name="lavoration_planned" />
                <field name="lavoration_all_planned" />
                <field name="total_production_loaded" />
                <!--<field name="total_production_material_anomaly" />                
                <field name="total_production_material" />-->
            </field>

            <!-- Show correct status -->
            <field name="state" position="attributes">
               <attribute name="invisible">1</attribute>
            </field>
            <field name="state" position="after">
               <field name="accounting_state" />
            </field>
        </field>
    </record>    

    <record model="ir.ui.view" id="mrp_production_anomaly_tree_view">
        <field name="name">Production tree anomaly</field>
        <field name="model">mrp.production</field>
        <field name="priority" eval="30" />
        <field name="arch" type="xml">
            <tree colors="red:total_production_material_anomaly==True" string="Production order">
	            <field name="total_production_material_anomaly" invisible="1"/>
	            <field name="name" />
	            <field name="date_planned" />
	            <field name="product_id" />
	            <field name="product_uom" invisible="1"/>
	            <field name="product_qty" sum="Qtà totale" />
	            <field name="total_production_material" />
	            <field name="lavoration_planned" />
	            <field name="lavoration_all_planned" />
	            <field name="total_production_loaded" sum="Qtà totale" />
	            <field name="accounting_state" />
	            <field name="state" invisible="1" />
            </tree>
        </field>
    </record>        

    <record model="ir.actions.act_window" id="action_mrp_production_anomaly_tree">
        <field name="name">Production with anomaly</field>
        <field name="res_model">mrp.production</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="mrp_production_anomaly_tree_view"/>
    </record>

    <record model="ir.ui.view" id="default_mrp_production_form_view">
        <field name="name">Production default</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.mrp_production_form_view" />
        <field name="arch" type="xml">
            <field name="user_id" position="after">
                <field name="state_info" />
            </field>

            <!-- New header -->
            <xpath expr="/form/header" position="replace">
                <header>
                    <button name="trigger_accounting_cancel_a" type="workflow" string="Cancel" attrs="{'invisible':[('accounting_state','not in',('production',))],}" />
                    <button name="trigger_accounting_cancel_b" type="workflow" string="Cancel" attrs="{'invisible':[('accounting_state','not in',('close',))],}"  />
                    <button name="trigger_accounting_production" type="workflow" class="oe_highlight" string="In produzione" attrs="{'invisible':[('accounting_state','not in',('draft',))],}"/>
                    <button name="trigger_accounting_close" type="workflow" class="oe_highlight" string="Close" attrs="{'invisible':[('accounting_state','not in',('production',))],}" />
                    <button name="trigger_accounting_draft" type="workflow" class="oe_highlight" string="Restart" attrs="{'invisible':[('accounting_state','not in',('cancel',))],}" />

                    <button name="dummy_refresh" type="object" icon="gtk-refresh" string="Refresh" attrs="{'invisible':[('accounting_state','in',('cancel','close'))],}" />
		            <field name="accounting_state" widget="statusbar" statusbar_visible="draft,production,close,cancel" />
		            <field name="state" invisible="1" />
	            </header>       
            </xpath>            
            <field name="product_qty" position="attributes">
                <attribute name="on_change">on_change_qty_alert()</attribute>
            </field>
            <field name="product_id" position="after">
                <field name="accounting_qty" readonly="1" help="Used for evaluate if production has correct quantity"/>
            </field>
            <!--Hide notebook -->
            <xpath expr="/form/sheet/notebook" position="attributes">
                <attribute name="invisible">1</attribute>
            </xpath>
            <!-- Hide origin-->
            <field name="origin" position="attributes">
                <attribute name="invisible">1</attribute>
            </field>
            <!-- Create button BOM-->
            <!--<field name="bom_id" position="after">
                <button type="object" colspan="2" name="standalone_lavoration" string="All in one lavoration" class="oe_highlight" />
            </field>-->

            <!--New notebook -->
            <xpath expr="/form/sheet/notebook" position="after">
                <notebook>
			        <page string="Prodotti Utilizzati">
				        <group string="Articoli Prodotti">				
                            <button type="object" colspan="2" name="load_materials_from_bom" string="Load element from BOM" class="oe_highlight"/>
                            <newline />
					        <field name="bom_material_ids" nolabel="1" colspan="4">
					            <tree string="Material BOM list" editable="bottom">
                                    <field name="product_id" />
                                    <field name="uom_id" readonly="1" />
                                    <field name="quantity" sum="total"/>
                                    <field name="accounting_qty" />
                                </tree>                                
					        </field>
					    </group>
				    </page>
			        <page string="Bolle di lavorazione">
				        <group string="Bolle di lavorazione">				              
					        <field name="workcenter_lines" nolabel="1" context="{'default_production_id':id,}">
					            <tree string="Workcenter lines" colors="blue:state == 'startworking';geen:state == 'done';grey:state == 'draft';red:(state in ('pause','cancel'))">
                                    <field name="name" />
                                    <field name="real_date_planned" />                                    
                                    <field name="name" invisible="1"/>
                                    <field name="workcenter_id"/>
                                    <field name="product_qty" sum="total"/>
                                    <field name="real_product_qty" sum="total" />
                                    <button name="%(action_split_mrp_production_wizard_form)d" string="Split" type="action" attrs="{'invisible':[('state','in',('done','cancel'))]}" icon="gtk-dnd-multiple"/>
                                    <field name="state" />
                                </tree>
					        </field>
				        </group>
			        </page>
			        <page string="Loads">
				        <group string="Loads">				              
					        <field name="load_ids" nolabel="1" readonly="1">
					        </field>
				        </group>
			        </page>
			        <page string="Righe ordine evase">
				        <group string="Articoli Prodotti">				              
					        <field name="order_lines_ids" nolabel="1">
					            <tree string="OC line">
                                    <field name="order_id" />                   
                                    <field name="name" />
                                    <field name="partner_id" />
                                    <field name="date_deadline" />                    
                                    <field name="product_uom_qty" sum="Total" />
                                    <field name="product_uom" string="UOM"/>
                                    <field name="product_ul_id" string="Package"/>
                                    <field name="state" invisible="1" />
                                    <button name="free_line" type="object" string="Free line" icon="gtk-disconnect" />
                                </tree>
					            <form string="OC line">
					                <group colspan="4" col="4">
                                        <field name="sequence" readonly="1" />
                                        <field name="order_id" readonly="1" />                   
                                        
                                        <field name="name" readonly="1"/>
                                        <field name="partner_id" readonly="1"/>
                                        
                                        <field name="product_uom_qty" readonly="1"/>
                                        <field name="product_uom" readonly="1"/>

                                        <field name="product_ul_id" string="Package"/>
                                        <field name="date_deadline" readonly="1"/>                    

                                        <field name="state" invisible="1" />
                                    </group>    
                                </form>
					        </field>
				        </group>
				        <group string="Package">				              
					        <field name="package_ids" nolabel="1">
					            <tree string="Package" editable="bottom">
                                    <field name="production_id" invisible="1"/>
					                <field name="stock" />
                                    <field name="partner_id" attrs="{'required':[('stock','=',False)]}"/>
                                    <field name="quantity" sum="total"/>
                                    <field name="product_ul_id" />                                    
                                </tree>
					            <form string="Package extra sale order">
                                    <field name="stock" />
                                    <field name="product_ul_id" />                                    
                                    <field name="partner_id" attrs="{'required':[('stock','=',False)]}"/>
                                    <field name="production_id" invisible="1"/>
                                    <field name="quantity" sumn="total"/>
                                </form>
					        </field>
				        </group>
			        </page>
                </notebook>		
            </xpath>            
        </field>
    </record>

    <!-- production.customer.order.line *****************************-->
    <!-- For production manager (create production) -->
    <record model="ir.ui.view" id="view_sale_order_line_search">
        <field name="name">Search OC line</field>
        <field name="model">sale.order.line</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <search string="OC line">
                    <field name="partner_id" string="Partner" filter_domain="[('partner_id','=',self)]"/>
                    <field name="product_id" string="Product" filter_domain="[('product_id','=',self)]"/>
                    <field name="order_id" string="Order" filter_domain="[('order_id','=',self)]"/> 

                    <separator string="Situation:"/>
                    <filter icon="terp-go-home" name="covered_with_store" string="Covered with store" domain="[('use_accounting_qty','=',True)]"/>
                    <filter icon="terp-go-home" name="covered_with_production" string="Covered with production" domain="[('mrp_production_id','!=',False)]"/>
                    <filter icon="terp-go-home" name="uncovered" string="Uncovered" domain="[('mrp_production_id','=',False),('use_accounting_qty','=',False)]"/>
                    
                    <separator string="Package:"/>
                    <filter icon="terp-go-home" name="unpackaged" string="Without package" domain="[('product_ul_id','=',False)]"/>
                    
                    <separator string="Manage Production:"/>
                    <!--<filter icon="terp-go-home" name="to_produce" string="Not to produce" domain="[('to_produce','=',True),('mrp_production_id','=',False)]" />-->
                    <filter icon="terp-go-home" name="Production1" string="Produce (month 0)" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')),('mrp_production_id','=',False),('use_accounting_qty','=',False)]" context="{'group_by':'product_id'}"/><!--('to_produce','=',True),-->
                    <filter icon="terp-go-home" name="Production2" string="Produce (month 1)" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=2)).strftime('%%Y-%%m-01')),('mrp_production_id','=',False),('use_accounting_qty','=',False)]" context="{'group_by':'product_id'}"/>
                    <filter icon="terp-go-home" name="Production3" string="Produce (month 2)" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=3)).strftime('%%Y-%%m-01')),('mrp_production_id','=',False),('use_accounting_qty','=',False)]" context="{'group_by':'product_id'}"/>

                    <separator string="See Production:"/>
                    <filter string="Month 0 (all)" name="month1" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01')),('use_accounting_qty','=',False)]"/>
                    <filter string="Month 1 (all)" name="month2" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=2)).strftime('%%Y-%%m-01')),('use_accounting_qty','=',False)]"/>
                    <filter string="Month 2 (all)" name="month3" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=3)).strftime('%%Y-%%m-01')),('use_accounting_qty','=',False)]"/>

                    <group expand="1" string="Group By...">
                        <filter name="group_partner" string="Partner" icon="terp-partner" context="{'group_by':'partner_id'}"/>
                        <filter name="group_product" string="Product" icon="terp-accessories-archiver" context="{'group_by':'product_id'}"/>
                        <filter name="group_deadline" string="Deadline" icon="terp-accessories-archiver" context="{'group_by':'date_deadline'}"/>
                    </group>                    
            </search>
        </field>
    </record>
    <record model="ir.ui.view" id="view_sale_order_line_tree">
        <field name="name">OC line</field>
        <field name="model">sale.order.line</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <tree string="OC line" colors="red:accounting_state=='deleted';black:mandatory_delivery;blue:mrp_production_id;green:to_produce==False">
                    <field name="production_line" invisible="1" />
                    <field name="name" />
                    <field name="product_id" />
                    <field name="partner_id" />
                    <!--<field name="duelist_uncovered" invisible="1" />
                    <button name="button_duelist_uncovered" type="object" string="uncovered present" icon="gtk-dialog-error" attrs="{'invisible':[('duelist_uncovered','=',False)]}" />-->
                    <field name="order_id" />                   
                    <field name="mrp_production_id" />
                    <field name="state_info" />                                    
                    <field name="date_deadline" />                    
                    <field name="date_delivery" />
                    <field name="mandatory_delivery" invisible="1" />
                    <field name="product_uom" />
                    <field name="product_uom_qty" sum="Total" />
                    <field name="product_ul_id" string="Package"/>
                    <button name="close_with_accounting_store" type="object" string="Use mag." icon="gtk-go-forward" attrs="{'invisible':['|',('use_accounting_qty','=',True),('mrp_production_id','!=',False),]}"/>
                    <field name="use_accounting_qty" invisible="1"/>
                    <field name="accounting_qty" />
                    <field name="state" invisible="1" />
                    <field name="to_produce" invisible="1" />
                    <field name="accounting_state" />                    
            </tree>
        </field>
    </record>
    <record model="ir.ui.view" id="view_sale_order_line_form">
        <field name="name">OC line</field>
        <field name="model">sale.order.line</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <form string="OC line" version="7.0">
              <sheet string="OC line">
                <group colspan="4" col="4">
                    <separator string="Header:" colspan="4" />
                    <field name="order_id" /> 
                    <field name="date_deadline" />                    
                </group>   
                <group colspan="4" col="4">                
                    <separator string="Line:" colspan="4" />
                    <field name="sequence" />
                    <field name="product_ul_id" string="Package"/>                
                    
                    <field name="product_id" />
                    <field name="product_uom_qty" />                    
                </group>   
                <group colspan="4" col="6">                
                    <field name="accounting_qty" readonly="1"/>
                    <button name="close_with_accounting_store" type="object" string="Use mag." icon="gtk-go-forward" attrs="{'invisible':['|',('use_accounting_qty','=',True),('mrp_production_id','!=',False),]}"/>
                    <field name="use_accounting_qty" />
                </group>   
                <group colspan="4" col="4">
                    <field name="state" invisible="1"/>
                    <separator string="Description:" colspan="4" />
                    <field name="name"  />
                    <separator string="Production:" colspan="4" />
                    <field name="mrp_production_id" domain="[('product_id','=',product_id)]" readonly="1"/> 
                    <button name="%(action_assign_mrp_production_wizard_form)d" string="Assign lavoration" type="action" context="{'product_id':product_id}"/>
                </group>   
                <group>
                  <separator string="Note" colspan="4"/>
                </group>   
              </sheet>  
            </form>
        </field>
    </record>
    
    <!-- For SALE MANAGER (delivery) ####################################### -->
    <record model="ir.ui.view" id="view_sale_order_line_search_sale">
        <field name="name">Search OC line</field>
        <field name="model">sale.order.line</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <search string="OC line">
                <field name="partner_id" string="Partner" filter_domain="[('partner_id','=',self)]"/>
                <field name="product_id" string="Product" filter_domain="[('product_id','=',self)]"/>
                <field name="order_id" string="Order" filter_domain="[('order_id','=',self)]"/>  
         
                <filter icon="terp-go-home" name="NextM1" string="Deadline month 0" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=1)).strftime('%%Y-%%m-01'))]" />
                <filter icon="terp-go-home" name="NextM2" string="Deadline month 1" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=2)).strftime('%%Y-%%m-01'))]" />
                <filter icon="terp-go-home" name="NextM3" string="Deadline month 2" domain="['|',('date_deadline','=',False),('date_deadline','&lt;',(context_today()+relativedelta(months=3)).strftime('%%Y-%%m-01'))]" />

                <filter icon="terp-go-home" name="use_store" string="Use store" domain="[('use_accounting_qty','=',True)]" />

                <group expand="1" string="Group By...">
                    <filter name="group_partner" string="Partner" icon="terp-partner" context="{'group_by':'partner_id'}"/>
                    <filter name="group_order" string="Order" icon="terp-partner" context="{'group_by':'order_id'}"/>
                    <filter name="group_product" string="Product" icon="terp-accessories-archiver" context="{'group_by':'product_id'}"/>
                    <filter name="group_deadline" string="Deadline" icon="terp-partner" context="{'group_by':'date_deadline'}"/>
                </group>                    
            </search>
        </field>
    </record>    
    <record model="ir.ui.view" id="view_sale_order_line_tree_sale">
        <field name="name">OC line</field>
        <field name="model">sale.order.line</field>
        <field name="priority" eval="20"/>
        <field name="arch" type="xml">
            <tree string="OC line" colors="blue:mrp_production_id;red:date_deadline&lt;current_date;black:mandatory_delivery;">
                    <field name="production_line" invisible="1" />
                    <field name="name" invisible="1" />
                    <field name="partner_id" />
                    <!--<field name="duelist_uncovered" invisible="1" />
                    <button name="button_duelist_uncovered" type="object" string="uncovered present" icon="gtk-dialog-error" attrs="{'invisible':[('duelist_uncovered','=',False)]}" />-->
                    <field name="order_id" />                   
                    <field name="date_deadline" />                    
                    <field name="date_delivery" />
                    <field name="mandatory_delivery" />
                    <field name="product_id" />
                    <field name="product_uom" />
                    <field name="product_uom_qty" sum="Total" />
                    <button name="close_with_accounting_store" type="object" string="Use mag." icon="gtk-go-forward" attrs="{'invisible':['|',('use_accounting_qty','=',True),('mrp_production_id','!=',False),]}"/>
                    <field name="use_accounting_qty" invisible="1"/>
                    <field name="accounting_qty" />
                    <field name="mrp_production_id" />                                       
                    <field name="state_info" />                                    
                    <field name="state" invisible="1"/>
            </tree>
        </field>
    </record>    
    <record model="ir.actions.act_window" id="action_view_sale_order_line_sale">   <!--ALL LINE FROM ACCOUNTING NOT DELETED -->
        <field name="name">OC sales analysis</field>
        <field name="res_model">sale.order.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="search_view_id" ref="view_sale_order_line_search_sale"/>
        <field name="view_id" ref="view_sale_order_line_tree_sale"/>
        <field name="domain">[('accounting_state','!=','deleted'),('accounting_order','=',True)]</field>
        <field name="context">{'form_view_ref':'production_line.view_sale_order_line_form'}</field>
    </record>
    <!-- ################################################################### -->

     <record model="ir.ui.view" id="view_sale_order_line_graph">
        <field name="name">OC per product</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <graph string="Product for production" type="bar">
                <field name="product_id"/>
                <field name="product_uom_qty" operator="+" />
            </graph>
        </field>
    </record>
    <record model="ir.ui.view" id="view_sale_order_line_calendar">
        <field name="name">Calendar OC for product</field>
        <field name="model">sale.order.line</field>
        <field name="arch" type="xml">
            <calendar color="product_id" date_start="date_deadline" string="Product">
                <field name="name" />
                <field name="partner_id" />
                <field name="product_uom_qty" />
            </calendar>
        </field>
    </record>

    <record model="ir.actions.act_window" id="action_view_sale_order_line">   <!--ALL PRODUCTION LINE FROM ACCOUNTING -->
        <field name="name">OC line analysis production</field>
        <field name="res_model">sale.order.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,graph,calendar</field>
        <field name="search_view_id" ref="view_sale_order_line_search"/>
        <field name="view_id" ref="view_sale_order_line_tree"/>
        <field name="domain">[('accounting_order','=',True),('production_line','=',True)]</field>
        <field name="context">{'form_view_ref':'production_line.view_sale_order_line_form'}</field>
    </record>
    <!-- Tolto: ('use_accounting_qty','=',False)-->
    <record model="ir.actions.act_window" id="action_view_sale_order_line_d10">   <!--ALL PRODUCTION LINE FROM ACCOUNTING NOT DELETED Month 0-->
        <field name="name">OC line analysis</field>
        <field name="res_model">sale.order.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,graph,calendar</field>
        <field name="search_view_id" ref="view_sale_order_line_search"/>
        <field name="view_id" ref="view_sale_order_line_tree"/>
        <field name="domain">[('accounting_state','!=','deleted'),('accounting_order','=',True),('production_line','=',True)]</field>
        <field name="context">{'form_view_ref':'production_line.view_sale_order_line_form','search_default_Production1':True,}</field>
    </record>
    <record model="ir.actions.act_window" id="action_view_sale_order_line_d20">   <!--ALL PRODUCTION LINE FROM ACCOUNTING NOT DELETED Month 1-->
        <field name="name">OC line analysis</field>
        <field name="res_model">sale.order.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,graph,calendar</field>
        <field name="search_view_id" ref="view_sale_order_line_search"/>
        <field name="view_id" ref="view_sale_order_line_tree"/>
        <field name="domain">[('accounting_state','!=','deleted'),('accounting_order','=',True),('production_line','=',True)]</field>
        <field name="context">{'form_view_ref':'production_line.view_sale_order_line_form','search_default_Production2':True,}</field>
    </record>
    <record model="ir.actions.act_window" id="action_view_sale_order_line_d30">   <!--ALL PRODUCTION LINE FROM ACCOUNTING NOT DELETED Month 2-->
        <field name="name">OC line analysis</field>
        <field name="res_model">sale.order.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,graph,calendar</field>
        <field name="search_view_id" ref="view_sale_order_line_search"/>
        <field name="view_id" ref="view_sale_order_line_tree"/>
        <field name="domain">[('accounting_state','!=','deleted'),('accounting_order','=',True),('production_line','=',True)]</field>
        <field name="context">{'form_view_ref':'production_line.view_sale_order_line_form','search_default_Production3':True,}</field>
    </record>

    <record model="ir.ui.view" id="view_mrp_production_filter_extra">
        <field name="name">Search Production order</field>
        <field name="model">mrp.production</field>
        <field name="inherit_id" ref="mrp.view_mrp_production_filter"/>
        <field name="arch" type="xml">
           <field name="name" position="after">
                <filter icon="terp-go-home" name="only_open" string="Only open" domain="[('accounting_state','in',('draft','production'))]" />
           </field>    
        </field>
    </record>   

    <record model="ir.actions.act_window" id="action_view_mrp_production">
        <field name="name">Production order open</field>
        <field name="res_model">mrp.production</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar</field>
    </record>

    <record model="ir.actions.act_window" id="action_view_mrp_production_standard">
        <field name="name">Production</field>
        <field name="res_model">mrp.production</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="context">{'search_default_only_open':1}</field>        
    </record>
    <record model="ir.actions.act_window" id="action_view_mrp_production_incomplete">
        <field name="name">Production order open</field>
        <field name="res_model">mrp.production</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar</field>
        <field name="domain">[('lavoration_all_planned','=',False),('accounting_state','not in',('close','cancel'))]</field>
    </record>

    <record model="ir.actions.act_window" id="action_view_lavoration_open">
        <field name="name">Lavoration open to plan</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar,graph</field>
        <field name="context">{'calendar_view_ref':'production_line.mrp_production_workcenter_line_calendar_planner_view','search_default_only_open':1}</field>
    </record>
    <record model="ir.actions.act_window" id="action_view_lavoration_today">
        <field name="name">Lavoration open today</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar,graph</field>
        <field name="domain">[('real_date_planned','&gt;=',time.strftime('%Y-%m-%d 00:00:00')),('real_date_planned','&lt;=',time.strftime('%Y-%m-%d 23:59:59'))]</field>
        <field name="context">{'calendar_view_ref':'production_line.mrp_production_workcenter_line_calendar_planner_view','group_by':'workcenter_id'}</field>
    </record>

    <record model="ir.actions.act_window" id="action_view_lavoration_today_standard">
        <field name="name">Lavoration</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar,graph</field>
        <field name="view_id" ref="production_line.mrp_production_workcenter_line_calendar_planner_view"/>
        <field name="context">{'calendar_view_ref':'production_line.mrp_production_workcenter_line_calendar_planner_view','search_default_only_open':1}</field>
    </record>
    <record model="ir.actions.act_window" id="action_view_lavoration_today_todo">
        <field name="name">Lavoration open today</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar,graph</field>
        <field name="context">{'calendar_view_ref':'production_line.mrp_production_workcenter_line_calendar_planner_view','search_default_MRP_today':True}</field>
    </record>
    <record model="ir.actions.act_window" id="action_view_lavoration_today_todo-1">
        <field name="name">Lavoration open passed</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar,graph</field>
        <field name="context">{'calendar_view_ref':'production_line.mrp_production_workcenter_line_calendar_planner_view','search_default_MRP_more_yesterday':True,'search_default_only_open':True}</field>
    </record>
    <record model="ir.actions.act_window" id="action_view_lavoration_today_todo+1">
        <field name="name">Lavoration open future</field>
        <field name="res_model">mrp.production.workcenter.line</field>
        <field name="view_type">form</field>
        <field name="view_mode">tree,form,calendar,graph</field>
        <field name="context">{'calendar_view_ref':'production_line.mrp_production_workcenter_line_calendar_planner_view','search_default_MRP_more_tomorrow':True,'search_default_only_open':True}</field>
    </record>

       <!-- Create production order from customer order lines-->
       <!--Override parent: -->
       <record id="base.menu_mrp_root" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin'),ref('group_production_commercial'),ref('group_production_logistic'),ref('group_production_stock')])]"/>
       </record>
       <record id="base.menu_reporting" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin')])]"/>
       </record>
       <record id="base.menu_base_partner" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin'),ref('group_production_commercial')])]"/>
       </record>
       <record id="stock.menu_stock_root" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin'),ref('group_production_stock')])]"/>
       </record>
       <record id="base.menu_purchase_root" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin'),ref('group_production_purchase')])]"/>
       </record>
       <record id="account.menu_finance" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin'),ref('group_production_accounting')])]"/>
       </record>
       <record id="knowledge.menu_document" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin')])]"/>
       </record>
       <record id="mail.mail_feeds_main" model="ir.ui.menu">
         <field name="groups_id" eval="[(6,0,[ref('group_production_admin'),ref('group_production_comunication')])]"/>
       </record>

      <!-- Establishment:  -->      
       <menuitem name="Establishment" id="root_establishment" sequence="0" 
           groups="group_production_production"/> 
          <menuitem name="Production" parent="root_establishment" 
              id="menu_root_establishment" 
              sequence="10" />         
              <menuitem name="Lavoration TODO" parent="menu_root_establishment" 
                  id="menu_root_establishment_todo" 
                  action="action_view_lavoration_today_todo" sequence="10" />
                  <menuitem name="Passed" parent="menu_root_establishment_todo" 
                      id="menu_root_establishment_todo-1" 
                      action="action_view_lavoration_today_todo-1" sequence="10" />
                  <menuitem name="Future" parent="menu_root_establishment_todo" 
                      id="menu_root_establishment_todo+1" 
                      action="action_view_lavoration_today_todo+1" sequence="20" />
          <menuitem name="Report" parent="root_establishment" 
              id="menu_root_establishment_report" 
              sequence="20" />         
                  <menuitem name="Weekly planner" parent="menu_root_establishment_report" 
                      id="menu_root_establishment_report_week_plan" 
                      action="action_mrp_print_lavoration_week_wizard_view" sequence="10" />

       <!-- Production block -->
       <menuitem name="1. OC to production order" parent="mrp.menu_mrp_manufacturing" id="menu_base_production_root_production" sequence="0" groups="group_production_admin" />
          <menuitem name="OC (Month 0)" parent="menu_base_production_root_production" id="menuitem_sale_order_line_d10" action="action_view_sale_order_line_d10" sequence="10" />
          <menuitem name="OC (Month 1)" parent="menu_base_production_root_production" id="menuitem_sale_order_line_d20" action="action_view_sale_order_line_d20" sequence="20" />
          <menuitem name="OC (Month 2)" parent="menu_base_production_root_production" id="menuitem_sale_order_line_d30" action="action_view_sale_order_line_d30" sequence="30" />
          <menuitem name="OC line (all open)" parent="menu_base_production_root_production" id="menuitem_sale_order_line" action="action_view_sale_order_line" sequence="40" />
          <menuitem name="Status analysis" parent="menu_base_production_root_production" id="menuitem_status_analysys_1" action="product_status_wizard_action" sequence="50" />
          <menuitem name="Covered report"  parent="menu_base_production_root_production" id="menu_sale_order_line_covered_wizard_1" action="action_sale_order_line_covered_wizard_form" sequence="60" />

       <!-- Create and plan lavoration order from production order -->
       <menuitem name="2. Production to lavoration order" parent="mrp.menu_mrp_manufacturing" id="menu_base_production_root_lavoration" sequence="0" action="action_view_mrp_production_standard" groups="group_production_admin" />
          <menuitem name="Production order (incomplete)" parent="menu_base_production_root_lavoration" id="menu_base_production_root_lavoration_incomplete" action="action_view_mrp_production_incomplete" sequence="10" />
          <menuitem name="Production order (all)" parent="menu_base_production_root_lavoration" id="menu_base_production_root_lavoration_open" action="action_view_mrp_production" sequence="20" />
          <menuitem name="Status analysis" parent="menu_base_production_root_lavoration" id="menuitem_status_analysys_2" action="product_status_wizard_action" sequence="30" />

       <!-- Plan lavoration  -->
       <menuitem name="3. Plan lavoration" parent="mrp.menu_mrp_manufacturing" id="menu_base_production_root_lavoration_plan" sequence="0" action="action_view_lavoration_today_standard" groups="group_production_admin" />
          <menuitem name="Lavoration open" parent="menu_base_production_root_lavoration_plan" id="menu_base_production_root_lavoration_plan_open" action="action_view_lavoration_open" sequence="10" />
          <menuitem name="Weekly planner" parent="menu_base_production_root_lavoration_plan" id="menu_base_production_root_reporting_wizard_3" action="action_mrp_print_lavoration_week_wizard_view" sequence="20" />
          <menuitem name="Status analysis" parent="menu_base_production_root_lavoration_plan" id="menuitem_status_analysys_3" action="product_status_wizard_action" sequence="30" />

       <!-- Fabbrica  -->
       <menuitem name="4. Lavoration" parent="mrp.menu_mrp_manufacturing" id="menu_base_production_root_lavoration_mrp" sequence="0" action="action_view_lavoration_today_standard" groups="group_production_admin" />
          <menuitem name="Lavoration today todo" parent="menu_base_production_root_lavoration_mrp" id="menu_base_production_root_lavoration_todo" action="action_view_lavoration_today_todo" sequence="10" />
          <menuitem name="Lavoration today" parent="menu_base_production_root_lavoration_mrp" id="menu_base_production_root_lavoration_today" action="action_view_lavoration_today" sequence="20" />

       <!-- Sale  -->
       <menuitem name="5. Sale and delivery" parent="mrp.menu_mrp_manufacturing" id="menu_base_production_root_delivery" sequence="0" groups="group_production_admin,group_production_logistic"/>
          <menuitem name="Production status for delivery" parent="menu_base_production_root_delivery" id="menu_base_production_root_delivery_line" action="action_view_sale_order_line_sale" sequence="10" />
          <menuitem name="Status analysis" parent="menu_base_production_root_delivery" id="menuitem_status_analysys_5" action="product_status_wizard_action" sequence="20" />

       <!-- Reporting -->
       <menuitem name="Reporting" parent="mrp.menu_mrp_manufacturing" id="menu_base_production_root_reporting" sequence="0" groups="group_production_admin,group_production_logistic,group_production_stock" />
          <menuitem name="Status analysis" parent="menu_base_production_root_reporting" id="menuitem_status_analysys" action="product_status_wizard_action" sequence="20" />
          <menuitem name="Weekly planner"  parent="menu_base_production_root_reporting" id="menu_base_production_root_reporting_wizard" action="action_mrp_print_lavoration_week_wizard_view" sequence="10" />
          <menuitem name="Covered report"  parent="menu_base_production_root_reporting" id="menu_sale_order_line_covered_wizard" action="action_sale_order_line_covered_wizard_form" sequence="30" />

       <!-- Controls -->
       <menuitem name="Controls" parent="mrp.menu_mrp_manufacturing" id="menu_base_production_root_production_control" sequence="0" groups="group_production_admin" />
           <menuitem name="Production anomaly" parent="menu_base_production_root_production_control" id="menu_base_production_root_production_control_anomaly" action="action_mrp_production_anomaly_tree" sequence="10" />
           <menuitem name="Material unload" parent="menu_base_production_root_production_control" id="menu_base_production_root_production_control_unload_material" action="action_mrp_production_material" sequence="20" />
           <menuitem name="End product load" parent="menu_base_production_root_production_control" id="menu_base_production_root_production_control_load_product" action="action_mrp_production_workcenter_load" sequence="30" />

    <!--TODO delete original menuitem -->
    <!--<menuitem name="Work Orders" parent="mrp.menu_mrp_manufacturing" id="menu_mrp_production_wc_order" action="mrp_production_wc_action_form" sequence="2"/>-->        
  </data>
</openerp>
