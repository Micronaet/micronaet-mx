<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <!--<record id="stock_move_tree" model="ir.ui.view">
            <field name="name">MX Stock Moves</field>
            <field name="model">mx.stock.move</field>
            <field name="field_parent">move_history_ids</field>
            <field name="arch" type="xml">
                <tree colors="grey:state == 'cancel'" string="Moves" create="false">
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom"  string="Unit of Measure" groups="product.group_uom"/>
                    <field name="prodlot_id"  groups="stock.group_production_lot"/>
                    <field name="tracking_id" groups="stock.group_tracking_lot"/>
                    <field name="product_packaging" domain="[('product_id','=',product_id)]" groups="product.group_stock_packaging"/>
                    <field name="picking_id"/>
                    <field name="location_id" groups="stock.group_locations"/>
                    <field name="location_dest_id" groups="stock.group_locations"/>
                    <field name="create_date" groups="base.group_no_one"/>
                    <field name="date" string="Date" groups="base.group_no_one"/>
                    <field name="date_expected" string="Date Expected"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="stock_move_tree2" model="ir.ui.view">
            <field name="name">Stock Moves</field>
            <field name="model">mx.stock.move</field>
            <field name="field_parent">move_history_ids2</field>
            <field name="arch" type="xml">
                <tree colors="grey:state == 'cancel'" string="Moves" create="false">
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom"  string="Unit of Measure" groups="product.group_uom"/>
                    <field name="prodlot_id"  groups="stock.group_production_lot"/>
                    <field name="tracking_id" groups="stock.group_tracking_lot"/>
                    <field name="product_packaging" domain="[('product_id','=',product_id)]" groups="product.group_stock_packaging"/>
                    <field name="picking_id"/>
                    <field name="location_id" groups="stock.group_locations"/>
                    <field name="location_dest_id" groups="stock.group_locations"/>
                    <field name="create_date" groups="base.group_no_one"/>
                    <field name="date" string="Date" groups="base.group_no_one"/>
                    <field name="date_expected" string="Date Expected"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="action3" model="ir.actions.act_window">
            <field name="name">Downstream traceability</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mx.stock.move</field>
            <field name="domain">[('id','in',active_ids)]</field>
            <field name="view_type">tree</field>
            <field eval="stock_move_tree2" name="view_id"/>
        </record>

        <record id="ir_move_traceability_upstream" model="ir.values">
            <field name="key2">tree_but_action</field>
            <field name="model">mx.stock.move</field>
            <field name="name">Downstream traceability</field>
            <field eval="'ir.actions.act_window,'+str(action3)" name="value"/>
        </record>

        <record id="action5" model="ir.actions.act_window">
            <field name="name">Upstream traceability</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">mx.stock.move</field>
            <field name="domain">[('id','in',active_ids)]</field>
            <field name="view_type">tree</field>
            <field eval="stock_move_tree" name="view_id"/>
        </record>

        <record id="ir_move_traceability_downstream" model="ir.values">
            <field name="key2">tree_but_action</field>
            <field name="model">mx.stock.move</field>
            <field name="name">Upstream traceability</field>
            <field eval="'ir.actions.act_window,'+str(action5)" name="value"/>
        </record>-->

        <record id="view_move_tree" model="ir.ui.view">
            <field name="name">stock.move.tree</field>
            <field name="model">mx.stock.move</field>
            <field eval="8" name="priority"/>
            <field name="arch" type="xml">
                <tree colors="grey:state == 'cancel';red:(state not in ('cancel','done')) and date > current_date" string="Moves">
                    <field name="name"/>
                    <field name="picking_id" string="Reference"/>
                    <field name="origin"/>
                    <field name="type" on_change="onchange_move_type(type)"/>
                    <field name="create_date" invisible="1" groups="base.group_no_one"/>
                    <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, False)"/>
                    <field name="product_qty" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"/>
                    <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                    <field name="product_uos" groups="product.group_uos"/>
                    <field name="prodlot_id" groups="stock.group_production_lot"/>
                    <!--<field name="tracking_id" groups="stock.group_tracking_lot"/>-->
                    <field name="location_id" groups="stock.group_locations"/>
                    <field name="location_dest_id" groups="stock.group_locations"/>
                    <field name="date" groups="base.group_no_one"/>
                    <field name="date_expected"/>
                    <field name="state" invisible="1"/>
                    <button name="action_done" states="confirmed,assigned" string="Process" type="object" icon="gtk-go-forward" help="Done"/>
                </tree>
            </field>
        </record>

        <record id="view_move_picking_tree" model="ir.ui.view">
            <field name="name">stock.move.tree</field>
            <field name="model">mx.stock.move</field>
            <field eval="4" name="priority"/>
            <field name="arch" type="xml">
                <tree colors="grey:scrapped == True" string="Stock Moves">
                    <field name="product_id"/>
                    <field name="product_qty" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"/>
                    <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                    <field name="product_uos" groups="product.group_uos"/>
                    <field name="location_id" groups="stock.group_locations" invisible="1"/>
                    <field name="picking_id" invisible="1" />
                    <field name="create_date" invisible="1" />
                    <field name="date_expected" invisible="1" />
                    <field name="prodlot_id" groups="stock.group_production_lot"/>
                    <field name="location_dest_id" groups="stock.group_locations"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <record id="view_move_form" model="ir.ui.view">
            <field name="name">stock.move.form</field>
            <field name="model">mx.stock.move</field>
            <field eval="1" name="priority"/>
            <field name="arch" type="xml">
                <form string="Stock Moves" version="7.0">
                <sheet>
                    <group>
                        <group name="main_grp" string="Details">
                            <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, False)"/>
                            <label for="product_qty"/>
                            <div>
                                <field name="product_qty"
                                    on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)"
                                    class="oe_inline"/>
                                <field name="product_uom" groups="product.group_uom" class="oe_inline"/>
                            </div>
                            <label for="product_uos_qty" groups="product.group_uos"/>
                            <div groups="product.group_uos">
                                <field name="product_uos_qty"
                                    on_change="onchange_uos_quantity(product_id, product_uos_qty, product_uos, product_uom)"
                                    class="oe_inline"/>
                                <field name="product_uos" class="oe_inline"/>
                            </div>
                            <field name="name"/>
                            <field name="company_id" groups="base.group_multi_company" widget="selection"/>
                        </group>
                        <group name="origin_grp" string="Origin">
                            <field name="origin" attrs="{'invisible': [('picking_id', '=', False)]}"/>
                            <field name="picking_id" domain="[('type','=',type)]"/>
                             <field name="type" on_change="onchange_move_type(type)"/>
                            <field name="location_id" groups="stock.group_locations"/>
                            <field name="create_date" groups="base.group_no_one"/>
                        </group>
                        <group name="destination_grp" string="Destination">
                            <field name="location_dest_id" groups="stock.group_locations"/>
                            <field name="partner_id" context="{'contact_display':'partner'}"
                                groups="stock.group_locations"/>
                            <field name="date_expected" on_change="onchange_date(date,date_expected)" attrs="{'invisible': [('state', '=', 'done')]}"/>
                            <field name="date" attrs="{'invisible': [('state', '!=', 'done')]}"/>
                        </group>
                        <group string="Traceability"
                            groups="stock.group_tracking_lot,stock.group_production_lot">
                            <label for="tracking_id" groups="stock.group_tracking_lot"/>
                            <div groups="stock.group_tracking_lot">
                                <field name="tracking_id" class="oe_inline"/>
                            </div>
                            <label for="prodlot_id" groups="stock.group_production_lot"/>
                            <div groups="stock.group_production_lot">
                                <field name="prodlot_id"
                                    context="{'location_id':location_id, 'product_id':product_id}"
                                    domain="[('product_id','=?',product_id)]" class="oe_inline"
                                    on_change="onchange_lot_id(prodlot_id,product_qty, location_id, product_id, product_uom)"/>
                            </div>
                        </group>
                    </group>
                </sheet>
                </form>
            </field>
        </record>

        <record id="view_move_picking_form" model="ir.ui.view">
            <field name="name">stock.move.form</field>
            <field name="model">mx.stock.move</field>
            <field eval="2" name="priority"/>
            <field name="arch" type="xml">
            <form string="Stock Moves" version="7.0">
                <group>
                    <group>
                        <field name="name" invisible="1"/>
                        <field name="product_id" on_change="onchange_product_id(product_id,location_id,location_dest_id, parent.partner_id)"/>
                        <field name="type" invisible="1"/>
                        <label for="product_qty"/>
                        <div>
                            <field name="product_qty" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)" class="oe_inline"/>
                            <field name="product_uom" string="Unit Of Measure" groups="product.group_uom" class="oe_inline"/>
                        </div>
                            <label for="product_uos_qty" groups="product.group_uos" invisible="1"/>
                            <div groups="product.group_uos" invisible="1">
                                <field name="product_uos_qty" on_change="onchange_uos_quantity(product_id, product_uos_qty, product_uos, product_uom)" class="oe_inline"/>
                                <field name="product_uos" on_change="onchange_quantity(product_id, product_qty, product_uom, product_uos)" class="oe_inline"/>
                            </div>
                            <field name="product_packaging" groups="product.group_stock_packaging" domain="[('product_id','=',product_id)]"/>
                            <field name="partner_id"/>
                            </group>
                            <group>
                                <field name="create_date" invisible="1"/>
                                <field name="date"/>
                                <field name="date_expected" on_change="onchange_date(date,date_expected)"/>
                            </group>

                            <group string="Locations" groups="stock.group_locations">
                                <field name="location_id" domain="[('usage','&lt;&gt;','view')]"/>
                                <field name="location_dest_id" domain="[('usage','in', ['internal', 'supplier', 'customer'])]" groups="stock.group_locations"/>
                            </group>

                            <group groups="stock.group_tracking_lot" string="Traceability">
                                <label for="tracking_id"/>
                                <div>
                                    <field name="tracking_id" groups="stock.group_tracking_lot" class="oe_inline"/>
                                 </div>

                                  <label for="prodlot_id"/>
                                  <div>
                                    <field name="prodlot_id" groups="stock.group_production_lot"
                                        context="{'location_id':location_id, 'product_id':product_id}"
                                        domain="[('product_id','=?',product_id)]"
                                        on_change="onchange_lot_id(prodlot_id,product_qty, location_id, product_id, product_uom)" class="oe_inline"/>
                            </div>
                        </group>
                    </group>
                </form>
            </field>
        </record>

        <record id="view_move_search" model="ir.ui.view">
            <field name="name">stock.move.search</field>
            <field name="model">mx.stock.move</field>
            <field eval="3" name="priority"/>
            <field name="arch" type="xml">
                <search string="Stock Moves">
                    <field name="origin" filter_domain="['|',('origin','ilike',self),('picking_id','ilike',self)]" string="Reference"/>
                    <field name="date" groups="base.group_no_one"/>

                    <filter icon="terp-go-today" string="Today" domain="[('date','&lt;=',time.strftime('%%Y-%%m-%%d 23:59:59')),('date','&gt;=',time.strftime('%%Y-%%m-%%d 00:00:00'))]" help="Orders processed Today or planned for Today"/>
                    <field name="product_id"/>
                    <field name="name" string="Location" filter_domain="['|',('location_id','ilike',self),('location_dest_id','ilike',self)]"/>
                    <field name="partner_id" string="Partner"  filter_domain="[('picking_id.partner_id','child_of',self)]"/>
                    <field name="prodlot_id"/>
                    <group expand="0" string="Group By...">
                        <filter string="Product" name="by_product" icon="terp-accessories-archiver" domain="[]"  context="{'group_by':'product_id'}"/>
                        <filter string="Picking" name="groupby_picking_id" icon="terp-accessories-archiver" domain="[]"  context="{'group_by':'picking_id'}"/>
                        <filter string="Serial  Number" name="groupby_prodlot_id" icon="terp-accessories-archiver" domain="[]"  context="{'group_by':'prodlot_id'}"/>
                        <filter string="Pack" name="groupby_tracking_id" icon="terp-accessories-archiver" domain="[]"  context="{'group_by':'tracking_id'}"/>
                        <filter string="Source" name="groupby_location_id" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'location_id'}" groups="stock.group_locations"/>
                        <filter string="Destination" name="groupby_dest_location_id" icon="terp-gtk-jump-to-ltr" domain="[]" context="{'group_by':'location_dest_id'}" groups="stock.group_locations"/>
                        <!--<filter icon="terp-stock_effects-object-colorize" string="Status" domain="[]" context="{'group_by':'state'}"/>-->
                        <filter string="Creation" name="groupby_create_date" icon="terp-go-month" domain="[]" context="{'group_by':'create_date'}" groups="base.group_no_one"/>
                        <filter string="Scheduled" name="groupby_date" icon="terp-go-month" domain="[]" context="{'group_by':'date_expected'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record id="action_move_form2" model="ir.actions.act_window">
            <field name="name">Stock Moves</field>
            <field name="res_model">mx.stock.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_id" ref="view_move_tree"/>
            <field name="search_view_id" ref="view_move_search"/>
            <field name="context">{}</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to create a stock movement.
              </p><p>
                This menu gives you the full traceability of inventory
                operations on a specific product. You can filter on the product
                to see all the past or future movements for the product.
              </p>
            </field>
        </record>
        
        <record model="ir.actions.act_window.view" id="action_stock_move_tree_all">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_move_tree"/>
            <field name="act_window_id" ref="action_move_form2"/>
        </record>

        <record model="ir.actions.act_window.view" id="action_stock_move_form_all">
            <field name="sequence" eval="3"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_move_form"/>
        <field name="act_window_id" ref="action_move_form2"/>
        </record>

        <record id="view_move_tree_reception_picking" model="ir.ui.view">
            <field name="name">stock.move.tree2</field>
            <field name="model">mx.stock.move</field>
            <field name="priority" eval="6"/>
            <field name="arch" type="xml">
                <tree colors="grey:state == 'cancel'" string="Moves">
                    <field name="date" widget="date"/>
                    <field name="picking_id" string="Reference" invisible="1"/>
                    <field name="origin"/>
                    <field name="partner_id" string="Supplier"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                    <field name="location_id" invisible="1"/>
                    <field name="location_dest_id" invisible="1"/>
                    <field name="create_date" invisible="1"/>
                    <field name="date_expected" invisible="1"/>
                    <field name="prodlot_id" groups="stock.group_production_lot"/>
                    <field name="tracking_id" groups="stock.group_tracking_lot"/>
                    <field name="state" invisible="1"/>
                </tree>
            </field>
        </record>

        <!-- test -->
        <record id="view_move_tree_reception_picking_board" model="ir.ui.view">
            <field name="name">stock.move.tree3</field>
            <field name="model">mx.stock.move</field>
            <field eval="6" name="priority"/>
            <field name="arch" type="xml">
                <tree string="Moves">
                    <field name="picking_id" string="Reference"/>
                    <field name="product_id"/>
                    <field name="product_qty"/>
                    <field name="product_uom" string="Unit of Measure" groups="product.group_uom"/>
                    <field name="date" groups="base.group_no_one"/>
                </tree>
            </field>
        </record>

        <record id="action_reception_picking_move" model="ir.actions.act_window">
            <field name="name">Incoming  Products</field>
            <field name="res_model">mx.stock.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">['|','&amp;',('picking_id','=',False),('location_id.usage', 'in', ['customer','supplier']),'&amp;',('picking_id','!=',False),('picking_id.type','=','in')]</field>
            <field name="view_id" ref="view_move_tree_reception_picking"/>
            <field name="context">{'product_receive': True, 'search_default_future': True, 'picking_type': 'in'}</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to register a product reception. 
              </p><p>
                Here you can receive individual products, no matter what
                purchase order or picking order they come from. You will find
                the list of all products you are waiting for. Once you receive
                an order, you can filter based on the name of the supplier or
                the purchase order reference. Then you can confirm all products
                received using the buttons on the right of each line.
              </p>
            </field>
        </record>

        <record model="ir.actions.act_window.view" id="action_move_reception_picking_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="view_move_tree_reception_picking"/>
            <field name="act_window_id" ref="action_reception_picking_move"/>
        </record>
        <record model="ir.actions.act_window.view" id="action_move_reception_picking_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_move_form"/>
            <field name="act_window_id" ref="action_reception_picking_move"/>
        </record>

        <act_window
            context="{'search_default_product_id': [active_id], 'default_product_id': active_id}"
            id="act_product_stock_move_open"
            name="Inventory Move"
            res_model="stock.move"
            src_model="product.product"/>

        <act_window
            context="{'search_default_future': 1,'search_default_product_id': [active_id], 'default_product_id': active_id}"
            id="act_product_stock_move_futur_open"
            name="Future Stock Moves"
            res_model="stock.move"
            src_model="product.product"/>

        <record id="action_out_picking_move" model="ir.actions.act_window">
            <field name="name">Deliver Products</field>
            <field name="res_model">mx.stock.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">['|','&amp;',('picking_id','=',False),('location_dest_id.usage', 'in', ['customer','supplier']),'&amp;',('picking_id','!=',False),('picking_id.type','=','out')]</field>
            <field name="view_id" ref="view_move_tree_reception_picking"/>
            <field name="context">{'picking_type': 'out', 'search_default_future': True}</field>
            <field name="help" type="html">
              <p class="oe_view_nocontent_create">
                Click to register a product delivery.
              </p>
              <p>
                You will find in this list all products you have to deliver to
                your customers. You can process the deliveries directly from
                this list using the buttons on the right of each line. You can
                filter the products to deliver by customer, products or sale
                order (using the Origin field).
              </p>
            </field>
        </record>
    </data>
</openerp>
